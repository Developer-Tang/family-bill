# Go服务初始化

## 本次操作目录

```
bill-server
├── data
│   ├── family_bill.db
│   ├── config.yaml
│   └── images
├── internal
│   ├── model
│   ├── rest
│   └── service
├── pkg
│   ├── db
│   ├── logger
│   └── utils
├── dict.json
└── main.go
```

## 本次配置要求

```yaml
server:
  port: 8000 # 服务端口
  
db:
  driver: sqlite
  dsn: ./data/family_bill.db
  # driver: mysql
  # dsn: root:123456@tcp(127.0.0.1:3306)/family_bill?charset=utf8mb4&parseTime=True&loc=Local
  max_idle: 10 # 最大空闲连接数
  max_open: 100 # 最大打开连接数
  max_life: 300 # 连接最大生命周期，单位秒

jwt:
  secret: 123456
  
swagger:
  enabled: true
  path: /swagger
  title: Family Bill API
  version: 1.0.0
  description: API文档

logger:
  level: info # 日志级别
  path: ./logs # 日志路径
  max_size: 100 # 日志文件最大大小，单位MB
  max_age: 30 # 日志文件最大保存时间，单位天
```

## 本次开发框架要求

- 采用gin框架
- 采用gorm框架
- 采用logrus框架
- 采用jwt框架
- 采用gin-swagger框架
- 采用gin-validator框架
- 采用gin-cors框架

## 本次操作数据库表结构

```sql
CREATE TABLE IF NOT EXISTS tb_users (
  id INTEGER PRIMARY KEY AUTOINCREMENT COMMENT '用户ID',
  username VARCHAR(128) UNIQUE NOT NULL COMMENT '用户名',
  password VARCHAR(128) NOT NULL COMMENT '密码',
  email VARCHAR(128) UNIQUE NOT NULL COMMENT '邮箱',
  avatar TEXT COMMENT '头像',
  have_role VARCHAR(128) DEFAULT 'editor' COMMENT '拥有角色 admin,editor,viewer',
  status TINYINT DEFAULT 0 COMMENT '状态 0:未激活,1:启用,2:禁用',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '更新时间'
) charset=utf8mb4 comment '用户表';
```

```sql
CREATE TABLE IF NOT EXISTS tb_logins (
  id INTEGER PRIMARY KEY AUTOINCREMENT COMMENT '登录记录ID',
  user_id INTEGER NOT NULL COMMENT '用户ID',
  ip VARCHAR(128) NOT NULL COMMENT '登录IP',
  ua VARCHAR(128) NOT NULL COMMENT '登录UA',
  token VARCHAR(128) NOT NULL COMMENT '登录Token',
  expires_at TIMESTAMP NOT NULL COMMENT '过期时间',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '更新时间'
) charset=utf8mb4 comment '登录记录表';
```

```sql
CREATE TABLE IF NOT EXISTS tb_verify_codes (
  id INTEGER PRIMARY KEY AUTOINCREMENT COMMENT '验证码ID',
  user_id INTEGER NOT NULL COMMENT '用户ID',
  code VARCHAR(128) NOT NULL COMMENT '验证码',
  type VARCHAR(128) NOT NULL COMMENT '验证码类型',
  expires_at TIMESTAMP NOT NULL COMMENT '过期时间',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '更新时间'
) charset=utf8mb4 comment '验证码表';
```

```sql
CREATE TABLE IF NOT EXISTS tb_operations (
  id INTEGER PRIMARY KEY AUTOINCREMENT COMMENT '操作记录ID',
  user_id INTEGER NOT NULL COMMENT '用户ID',
  ip VARCHAR(128) NOT NULL COMMENT '操作IP',
  ua VARCHAR(128) NOT NULL COMMENT '操作UA',
  path VARCHAR(128) NOT NULL COMMENT '操作路径',
  method VARCHAR(128) NOT NULL COMMENT '操作方法',
  params TEXT COMMENT '操作参数',
  body TEXT COMMENT '操作请求体',
  result TEXT COMMENT '操作结果',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '更新时间'
) charset=utf8mb4 comment '操作记录表';
```

## 本次操作规范
- 初始化项目时，需要根据目录结构创建必要的目录和文件
- 初始化项目时，需要根据配置文件要求配置必要的参数
- 初始化项目时，需要根据框架要求引入必要的依赖
- 初始化项目时，需要根据数据库表结构要求创建必要的数据库表
- 添加代码时，需要根据框架要求使用必要的组件
- 添加代码时，需要根据操作规范编写必要的代码
- 添加代码时，考虑代码的可复用性，避免重复编写相同的代码
- 添加代码时，数据需要有必要的校验和处理
- 添加代码时，需要根据操作规范编写必要的注释
- 添加代码时，需要考虑代码的性能和效率
- 添加代码时，禁止在代码中使用硬编码的敏感信息，如密码、密钥等
- 完成编码后，执行 `swag init` 更新文档内容